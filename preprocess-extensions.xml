<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="preprocess-map-first">

  <!-- ==========================================
       DITA Community Map-First Preprocessing

       Rearchitects the Open Toolkit preprocessing pipeline
       to do all map processing first, then do processing
       of topics to resolve conrefs, apply filtering,
       and create temporary topic files reflecting any
       copy-to and chunking defined in the map.

       ========================================== -->

    <target name="dc-preprocess-map-first"
      description="DITA Community map-first preprocessing"
      depends="
                gen-list,
                debug-filter,
                mapref,
                mappull,
                dc-adjust-copy-to,
                copy-files,
                conrefpush,
                conref,
                move-meta-entries,
                keyref,
                coderef,
                chunk,
                maplink,
                move-links,
                topicpull,
                flag-module"
      >
      <!-- This target replaces the base OT preprocess.


      -->
    </target>

    <target name="dc-preprocess"
      description="DITA Community map-first preprocessing"
      depends="dc-preprocess-check-version, dc-preprocess-1-6, dc-preprocess-latest-version">
      <!-- This target replaces the base OT preprocess.
      -->
    </target>

    <target name="dc-preprocess-1-6" depends="preprocess" if="dc-preprocess-1-6.do" />

    <target name="dc-preprocess-latest-version" if="dc-preprocess-latest.do" depends="
                gen-list,
                debug-filter,
                copy-files,
                conrefpush,
                conref,
                move-meta-entries,
                keyref,
                coderef,
                mapref,
                mappull,
                dc-adjust-copy-to,
                chunk,
                maplink,
                move-links,
                topicpull,
                flag-module"/>



    <target name="dc-preprocess-check-version">

      <condition property="dc-preprocess-1-6.do">
        <contains string="${otversion}" substring="1.6" />
      </condition>

      <condition property="dc-preprocess-latest.do">
        <not>
          <isset property="dc-preprocess-1-6.do" />
        </not>
      </condition>

    </target>


</project>
